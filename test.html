<html>
<body>
    <div style="position:relative; height:100px;">
        <textarea style = "top:0px;left:0px;position:absolute;width:100%;max-width:100%;;margin:10px auto;z-index:2;height:50px;background:none;" id="input"></textarea>
        <textarea style = "top:0px;left:0px;position:absolute;width:100%;max-width:100%;;margin:10px auto;z-index:1;height:50px;color:rgb(150,150,150);" id="guess"></textarea>
    </div>

    <p style="font-size:10px;font-family:'Courier', 'Monospace';" id="card"></p>
    <br />

    <button id="send2">Submit</button>
    <button id="send">Submit as card</button>
    <hr />
    <h3>Internal representation of CENode</h3>
    <div style="width:48%;float:left;margin-bottom:20px;">
        <p>Instances:</p>
        <textarea readonly style="width:100%;max-width:100%;height:400px;" id="instances"></textarea>
    </div>
    <div style="width:48%;float:right;margin-bottom:20px;">
        <p>Concepts:</p>
        <textarea readonly style="width:100%;max-width:100%;height:400px;" id="concepts"></textarea>
    </div>
    <p>Sentences:</p>
    <textarea readonly style="width:100%;max-width:100%;height:400px;" id="cards"></textarea>


    <script src="/cenode.js"></script>  
    <script>
        var text = document.getElementById("input");
        var send = document.getElementById("send");
        var send2 = document.getElementById("send2");
        var concepts = document.getElementById("concepts");
        var instances = document.getElementById("instances");
        var cards = document.getElementById("cards");
        var guess = document.getElementById("guess");
        
        var node = new CENode(MODELS.CORE);    

        function refresh_content(){
            setTimeout(function(){
                var c = node.get_concepts();
                var i = node.get_instances();
                concepts.value = JSON.stringify(c, undefined, 2);
                instances.value = JSON.stringify(i, undefined, 2);
                refresh_content();
            },200);
        }
        refresh_content();

        text.onkeyup = function(event){
            card.innerHTML = "there is a tell card named 'msg_{uid}' that is from the agent 'test user' and is to the agent 'Moira' and has '"+text.value.replace(/'/g, "\\'")+"' as content and has the timestamp '{now}' as timestamp.";
            guess.innerHTML = node.guess_next(text.value);               
            
        }
        text.onkeydown = function(event){
            if(event.keyCode == 9){
                text.value = node.guess_next(text.value);
                event.preventDefault();
            }
            if(event.keyCode == 13){
                send2.click();
                event.preventDefault();
            }
        }
        send.onclick = function(){
            node.add_sentence(card.innerHTML);
            text.value = "";
            card.innerHTML = "";
        };
        send2.onclick = function(){
            node.add_sentence(text.value);
            text.value = "";
            card.innerHTML = "";
        };
    
    </script>
</body> 
</html>
